rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // posts 컬렉션
    match /posts/{postId} {
      // 읽기는 모두 허용
      allow read: if true;
      
      // 조회수(views), 좋아요(likes), 나빠요(dislikes) 필드만 업데이트 허용
      allow update: if request.resource.data.diff(resource.data).affectedKeys()
        .hasOnly(['views']) || 
        request.resource.data.diff(resource.data).affectedKeys()
        .hasOnly(['likes']) ||
        request.resource.data.diff(resource.data).affectedKeys()
        .hasOnly(['dislikes']);
      
      // 서버에서만 생성 가능 (RSS 처리 스크립트)
      allow create: if false;
      
      // 생성/삭제는 서버에서만 가능
      allow create, delete: if false;
    }
    
    // 기타 모든 문서는 차단
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

